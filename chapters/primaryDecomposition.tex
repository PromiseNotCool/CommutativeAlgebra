\chapter{Primary Decomposition}

\begin{discussion}
    UFD's have prime factorization. In fact, it is ``if and only if''. Aternative version for non-UFD's.
    \begin{enumerate}
        \item irreducible factorization: 
            \[
                \begin{array}{ll}
                    \text{\underline{pros}} & \text{\underline{cons}} \\
                    \text{familiar} & \text{don't necessarily exist} 
                \end{array}.
            \]
        \item 
            primary decomposition:
            \[
                \begin{array}{ll}
                    \text{\underline{pros}} & \text{\underline{cons}} \\
                    \text{exists, e.g., if $R$ is noetherian,} & \text{reduce factorization of elements} \\
                \text{there exists more general than} & \text{with intersection of nice ideal}\\
                \text{just for principal ideal}
                \end{array}.
            \]
    \end{enumerate}
\end{discussion}

\begin{theorem}
    Let $R$ be a noetherian integral domain. Let $a \in R \setminus \{R^{\times} \cup 0\}$.
    \begin{enumerate}
        \item $a$ has an irreducible factorization in $R$.
        \item There exist irreducible $b_1,\cdots,b_n \in R$ such that $a = b_1 \cdots b_n$.
    \end{enumerate}
\end{theorem}

\begin{proof}
    \begin{enumerate}
        \item Let $\Sigma = \{\langle b \rangle \neq R : b \mid a\} \ni \langle a \rangle$. Since $R$ is noetherian, $\Sigma$ has a maximal element $\langle b \rangle$. Claim. $\langle b \rangle$ is irreducible. Note $b \neq 0$ since $a \neq 0$ and $b \mid a$, and $b \not \in R^{\times}$ since $\langle b \rangle \neq R$. Suppose $b = cd$ for some $c,d \in R \setminus R^{\times}$. Since $c \mid b \mid a$, we have $c \mid a$. Also, since $c \not \in R^{\times}$, $c \in \Sigma$. Since $\langle b \rangle \subseteq \langle c \rangle \subseteq R$, $\langle b \rangle$ is maximal and $c \not \in R^{\times}$, $\langle cd \rangle = \langle b \rangle = \langle c \rangle$. Since $R$ is an integral domain, $d \in R^{\times}$, a contradiction.
        \item \qedhere
    \end{enumerate}
\end{proof}

\begin{definition}
    If $R$ satisfies the conclusion of Theorem 4.2(b), then $R$ is \emph {atomic}.
\end{definition}

\begin{example}
    $\bbZ_6$: $3^{2} = 3$, $2^{2} = 4$, $2^{3} = 2$.
\end{example}

\begin{lemma}[Nakayamas Lemma]
    Let $I,J \leq R$ such that $I \subseteq \operatorname{Jac}(R)$ and $J$ is finitely generated. If $J = IJ$, then $J = 0$.
\end{lemma}

\begin{proof}
\end{proof}

\begin{lemma}
    Let $(R,\ffm)$ be local and $0 \neq b = cd$ with $b,c,d \in R$ such that $\langle b \rangle = \langle c \rangle$. Then $d \in R^{\times}$.
\end{lemma}

\begin{proof}
\end{proof}

\begin{theorem}
    Let $(R,\ffm)$ be local, noetherian, and $a \in R \setminus \{R^{\times} \cup 0\}$. 
    \begin{enumerate}
        \item $a$ has an irreducible factor in $R$.
        \item $a = b_1 \cdots b_n$ for some irreducible elements $b_1,\cdots,b_n \in R$.
    \end{enumerate}
\end{theorem}

\begin{proof}
\end{proof}

\begin{discussion}
    Let $R$ be noetherian (local or domain) and $a \in R \setminus \{R^{\times} \cup 0\}$ with irreducible factorization. ...
\end{discussion}

\begin{example}
\end{example}

\begin{definition}
    An ideal $\ffq \lneq R$ is \emph{primary} if $xy \in \ffq$ with $x,y \in R$, then $x \in \operatorname{rad}(\ffq)$ or $y \in \operatorname{rad}(\ffq)$, i.e., if $\overbar{x} \overbar{y} = 0$ with $\overbar{x}, \overbar{y} \in R/\ffq$, then $\overbar{x} \in \operatorname{Nil}(R/\ffq)$ or $\overbar{y} \in \operatorname{Nil}(R/\ffq)$. 
\end{definition}

\begin{example}
    \begin{enumerate}
        \item 
        \item
        \item 
        \item 
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item [(b)]
        \item [(c)]
        \item [(d)]
    \end{enumerate}
\end{proof}

\begin{example}
    \begin{enumerate}
        \item If $R$ is a UFD and $p \in R$ is prime, then $\langle p^{n} \rangle$ is primary.
        \item If $x \in R$ is irreducible, $\langle x \rangle$ may not be primary.
        \item Let $R = k[X_1,\cdots,X_d]$. Then $I = \langle X_{i_1}^{e_1}, \cdots ,X_{i_n}^{e_n} \rangle$ with $e_i \geq 1$ for $i = 1,\cdots,n$ and $J = \langle X_{1}^{e_1},\cdots,X_d^{e_d},f_1,\cdots,f_n \rangle \lneq R$ both are primary....
        \item Let $R = k[X,Y,Z]$. Then neither of $\langle X^{2},XY\rangle$ and $\langle \rangle$.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item 
            Let $x,y \in R$ such that $xy \in \langle p^{n} \rangle$. If $y \in \operatorname{rad}(\langle p^{n} \rangle) = \langle p \rangle$, then done. \par 
            Assume $y \not \in \langle p \rangle$. Then $p \nmid y$. Since $xy \in \langle p^{n} \rangle$, $p^{n} \mid xy$. Since $xy$ has a unique factorization, $p$ is irreducible and $p \nmid y$, we have $p^{n} \mid x$. So $x \in \langle p^{n} \rangle$.
        \item Let $R = \frac{k\llbracket X,Y,Z \rrbracket}{\langle X^{2}-YZ \rangle}$ and $x := \overbar{X} \in R$. Then $x$ is irreducible...
        
    \end{enumerate}
\end{proof}

\begin{definition}
    $\ffa \leq R$ is \emph{reducible} if $\ffa \neq R$ and there exist $I,J \leq R$ such that $\ffa = I \cap J$ and $I \neq \ffa \neq J$. \par 
    $\ffa \leq R$ is \emph{irreducible} if it is not reducible, i.e., for $I,J \leq R$, if $\ffa = I \cap J$, then $\ffa = I$ or $\ffa = J$.
\end{definition}

\begin{example}
\end{example}

\begin{proposition}
    Let $R$ be noetherian If $\ffa \leq R$ is irreducible, then $\ffa$ is primary.
\end{proposition}

\begin{definition}
    Let $\ffa \lneq R$. A \emph{primary decomposition} of $\ffa$ is $\ffa = \bigcap_{i=1}^{n} J_i$ such that $\ffa = \bigcap_{i=1}^{n}$ with $J_i$ is primary for $i = 1,\cdots,n$.
\end{definition}

\begin{theorem}[Noether]
    Assume $R$ is noetherian and $\ffa \lneq R$. Then $\ffa$ has a primary decomposition.
\end{theorem}

\begin{proposition}
    If $\ffq \lneq R$ is primary, then $\operatorname{rad}(\ffq) \in \operatorname{Spec}(R)$. In particular, $\operatorname{rad}(\ffq)$ is the unique smallest prime ideal of $R$ containing $\ffq$.
\end{proposition}

\begin{proof}
    Since $\ffq \neq R$, $\operatorname{rad}(\ffq) \neq R$. Let $x,y \in R$ such that $xy \in \operatorname{rad}(\ffq)$. Then $x^{m}y^{m} = (xy)^{m} \in \ffq$ for some $m \geq 1$. Since $\ffq$ is primary, $x^{m} \in \operatorname{rad}(\ffq)$ or $y^{m} \in \operatorname{rad}(\ffq)$. So $x \in \operatorname{rad}(\operatorname{rad}(\ffq)) = \operatorname{rad}(\ffq)$ or $y \in \operatorname{rad}(\ffq)$.
\end{proof}

\begin{definition}
    If $\ffq \lneq R$ is primary and $\ffp = \operatorname{rad}(\ffq)$, then $\ffq$ is $\ffp$-\emph{primary}.
\end{definition}

\begin{example}
    \begin{enumerate}
        \item Let $\ffp \in \bbZ$ be prime. Then $\ffq = \langle  p^{n} \rangle$ is primary for $n \geq 1$ and $\operatorname{rad}(\ffq) = \langle p  \rangle \in \operatorname{Spec}(\bbZ)$. 
        \item 
            If $\ffm \in \operatorname{m-Spec}(R)$ and $\ffm^{n} \subseteq \ffp \subseteq \ffm$, then $\operatorname{rad}(\ffq) = \ffm \in \operatorname{Spec}(R)$.
        \item Let $R = k[X_1,\cdots,X_n]$ and $\ffq = \langle X_{i_1}^{e_{1}},\cdots,X_{i_n}^{e_{n}} \rangle$ with $e_i \geq 1$ for $i=1,\cdots,n$, then $\operatorname{rad}(\ffq) = \langle X_{i_1},\cdots,X_{i_n} \rangle \in \operatorname{Spec}(R)$.
    \end{enumerate}
\end{example}

\begin{proof}

\end{proof}

\begin{proposition}
    Let $\ffq_1,\cdots,\ffq_n \lneq R$ be $\ffp$-primary. Then $\bigcap_{i=1}^{n} \ffq_i$ is $\ffp$-primary.
\end{proposition}

\begin{proof}
    Induct on $n$. The base case $n = 2$ is the important case....
\end{proof}

\begin{definition}
    A primary decomposition $\ffa = \bigcap_{i=1}^{n}\ffq_i$ is \emph{minimal} if 
    \begin{enumerate}
        \item $\operatorname{rad}(\ffq_i) \neq \operatorname{rad}(\ffq_j)$ for $1 \leq i,j \leq n$ with $i \neq j$,
        \item 
    \end{enumerate}
\end{definition}

\begin{example}
    \begin{enumerate}
        \item 
        \item 
    \end{enumerate}
\end{example}

\begin{remark}
    Notice: minimal primary decomposition is not necessarily unique up to re-ordering.
\end{remark}

\begin{definition}
    Let $\ffa = \bigcap_{i=1}^{n} \ffq_i$ be minimal primary decomposition such that $\operatorname{rad}(\ffq_i) = \ffp_i$ for $i = 1,\cdots,n$.
    \begin{enumerate}
        \item The \emph{associated primes} of $\ffa$ are $\ffp_1,\cdots,\ffp_n$. Write it as $\operatorname{Ass}(\ffa) = \{\ffp_1,\cdots,\ffp_n\}$.
        \item The \emph{minimal primes} of $\ffa$ are the minimal elements of $\{\ffp_1,\cdots,\ffp_n\}$ w.r.t. $\subseteq$. Write it as $\operatorname{Min}(\ffa) = \operatorname{Min}\{\ffp_1,\cdots,\ffp_n\}$.
        \item 
        \item 
    \end{enumerate}
\end{definition}

\begin{proposition}
\end{proposition}

\begin{proof}
\end{proof}

\begin{proposition}
    Let $\ffa \lneq R$ with minimal primary decomposition $\ffa = \bigcap_{i=1}^{n} \ffq_i$ with $\ffp_i = \operatorname{rad}(\ffp_i)$ for $i = 1,\cdots,n$. Re-order the $\ffq_i$'s such that if necessary to assume without loss of generality, $\operatorname{Min}(\ffq) = \{\ffp_1,\cdots,\ffp_m\}$. Then the irreducible components of $\operatorname{V}(\ffa)$ are $\operatorname{V}(\ffp_1),\cdots,\operatorname{V}(\ffp_m)$.
\end{proposition}

\begin{proof}
\end{proof}

\begin{proposition}
    Let $\ffq \lneq R$ be $\ffp$-primary and $x \in R$. Then 
    \[
        (\ffq:x) = \left\{
            \begin{array}{ll}
                R &\text{if }x \in \ffq \\
                \ffq &\text{if }x \not \in \ffp \\
                \ffp\text{-primary} &\text{if }x \not \in \ffq \\
            \end{array}
        \right..
    \]
\end{proposition}

Last time 4.30: If $\ffa \leq R$, has a minal primary decomposition $\ffa = \bigcap_{i=1}^{n}\ffq_i$ such that $\ffp_i = \operatorname{rad}(\ffq_i) \in \operatorname{Spec}(R)$, then $\{\ffp_1,\cdots,\ffp_n\} = \operatorname{Spec}(R) \cap \{\operatorname{rad}(\ffa:x) \mid x \in R\}$, i.e., independent of the decomposition. 

\begin{theorem}
    If $R$ is noetherian and $\ffa \lneq R$ with minimal primary decomposition $\ffa = \bigcap_{i=1}^{n} \ffq_i$ with $\ffp_i = \operatorname{rad}(\ffq_i)$ for $i = 1,\cdots,n$, then $\{\ffp_1,\cdots,\ffp_n\} = \operatorname{Spec}(R) \cap \{(\ffa:x) \mid x \in R\} = \operatorname{Spec}(R) \cap \{\operatorname{Ann}_R(\overbar{x}) \mid \overbar{x} \in R/\ffa\} =: \operatorname{Ass}(R/\ffa)$.
\end{theorem}

\begin{proof}
    First equality: ``$\supseteq$''. Let $\ffp \in \operatorname{Spec}(R)$ such that $\ffp = (\ffa:x)$ for some $x \in R$. Since $\ffp \in \operatorname{Spec}(R)$, $\ffp = \operatorname{rad}(\ffp) = \operatorname{rad}(\ffa:x)$. By 4.30, $\ffp = \ffp_i$ for some $i \in \{1,\cdots,n\}$. ``$\subseteq$''. Need to show there exists $x \in R$ such that $\ffp_i = (\ffa:x)$ for all $i=1,\cdots,n$. Minimality of decomposition $\ffa$ implies $\bigcap_{j=1, j \neq i}^{n} \ffq_j \supseteq \ffa$. So there exists $x \in (\bigcap_{j=1,j \neq i}^{n} \ffq_j) \setminus \ffa$. For $x \in (\bigcap_{j=1,j \neq i}^{n}\ffq_j) \setminus \ffa$, by proof of 4.30, $\operatorname{rad}(\ffa:x) = \ffp_i$. Since $R$ is noetherian, $\ffp_i$ is finitely generated and $\operatorname{rad}(\ffq_i) = \ffp_i$, there exists $m \geq 1$ such that $\ffp_i^{m} \subseteq \ffq$....  \par  
\end{proof}

\begin{example}
    If $R$ is not noetherian, then $\ffa \lneq R$ may not have a primary decomposition. Let $R = \llC([0,1]) = \{\text{continuous functions }f: [0,1] \to \bbR\}$ with pointwise operations. Claim: $0 \leq R$ does not have a primary decomposition.
    \begin{enumerate}
        \item For $a \in [0,1]$, define $\Phi_a: R \to R$ by $\Phi_a(f) = f(a)$. Then $\Phi_a$ is a well-defined ring epimorphism. So $\bbR \cong \frac{R}{\ker(\Phi_a)}$. So $\{f \in R \mid f(a) = 0\} = \ker(\Phi_a) \in \operatorname{m-Spec}(R) \subseteq \operatorname{Spec}(R)$.
        \item $0 \not \in \operatorname{Spec}(R)$. For $a \in (0,1)$, $g_a,h_a \in R$ and $g_ah_a = 0$ but $g_a,h_a \neq 0$.
        \item $\operatorname{Nil}(R) = 0$. Proof. Let $f \in \operatorname{Nil}(R)$. So $f^{m} = 0$ for some $m \geq 1$. Then $(f(a))^{m} = 0$ with $f(a) \in \bbR$ for all $a \in [0,1]$. So $f(a) = 0$ for all $a \in [0,1]$. Hence $f= 0$.
        \item 
        \item
            ....Now suppose $0 = \bigcap_{i=1}^{n}\ffq_i$ is a primary decomposition. Assume without loss of generality that the decomposition is minimal. For $i \in \{1,\cdots,n\}$, there exists $f \in R$ such that $\operatorname{Spec}(R) \not \ni (\ffa:f) = \operatorname{rad}(0:f) = \operatorname{rad}(\ffq_i) \in \operatorname{Spec}(R)$, a contradiction. 
        \item Note $0 = \bigcap_{a \in [0,1]} \ker(\Phi_n) = \bigcap_{a \in [0,1]} \smallunderbrace{\{f \in R \mid f(a) = 0\}}_{\in \operatorname{Spec}(R)} = \bigcap_{a \in [0,1] \cap \bbQ} \ker(\Phi_a)$ cannot be pround to a minimal decomposition.
    \end{enumerate}
\end{example}

\begin{proposition}
    If $\ffa \lneq R$ with minimal primary decomposition $\ffa = \bigcap_{i=1}^{n} \ffq_i$ such that $\ffp_i = \operatorname{rad}(\ffq_i)$ for $i = 1,\cdots,n$, then $D = \{x \in R \mid (\ffa:x) \neq \ffa\} = \bigcap_{i=1}^{n} \ffp_i = \bigcup_{\ffp \in \operatorname{Min}(\ffa)} \ffp$.
\end{proposition}

\begin{proof}
    Claim $D = \bigcup_{y \not\in \ffa} \operatorname{rad}(\ffa:y)$. ``$\subseteq$''. ``$\supseteq$''.
\end{proof}

\begin{corollary}
    If $0 \lneq R$ has a mimimal primary decomposition $0 = \bigcap_{i=1}^{n} \ffq_i$ such that $\ffp_i = \operatorname{rad}(\ffq_i)$ for $i = 1,\cdots,n$, then $\operatorname{ZD}(R) = \bigcup_{i=1}^{n} \ffp_i = \bigcup_{\ffp \in \operatorname{Ass}_R(0)}\ffp$.
\end{corollary}

summary:

\begin{example}
    Let $R = \frac{k[X,Y]}{\langle X^{2},XY \rangle} = \frac{k[X,Y]}{\langle X \rangle \cap \langle X^{2},Y \rangle}$.
\end{example}

\begin{proposition}
    Let $\ffa \lneq R_1$ with minimal primary decomposition. $\ffa = \bigcap_{i=1}^{n} \ffq_i$ with $\ffp_i = \operatorname{rad}(\ffq_i)$ for $i = 1,\cdot,n$. Then $\operatorname{Min}(\ffq) = \operatorname{Min}\{\ffp_1,\cdots,\ffp_n\} = \operatorname{Min}(\operatorname{V}(\ffa)) = \operatorname{Min}\{\ffp \supseteq \ffa)\}$. 
\end{proposition}

\begin{proof}
    4.28, $\operatorname{V}(\ffa) = \bigcup_{i=1}^{n} \operatorname{V}(\ffp_i)$. $\ffp_i \in \operatorname{Min}(R)$.
\end{proof}

\begin{lemma}
    Let $U \subseteq R$ be multiplicatively closed and $\ffq \subseteq R$ be $\ffp$-primary. Let $\psi: R \to U^{-1}R$ be the natural ring homomorphism.
    \begin{enumerate}
        \item If $U \cap \ffp \neq \emptyset$, then $U^{-1}\ffq = U^{-1}R$.
        \item If $U \cap \ffp = \emptyset$, then $U^{-1}\ffq \lneq U^{-1}R$ is $U^{-1}\ffp$-primary and $\psi^{-1}(U^{-1}\ffq) = \ffq$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    \begin{enumerate}
        \item 
        \item  \qedhere
    \end{enumerate}
\end{proof}

\begin{theorem}[Second uniqueness theorem]
    Let $\ffa \lneq R$ be minimal primary decomposition $\ffa = \bigcap_{i=1}^{n} \ffq_i$ with $\ffp_i = \operatorname{rad}(\ffq_i)$ for $i = 1,\cdots,n$. 
    \begin{enumerate}
        \item For $\ffp_i \in \operatorname{Min}(\ffq)$: $\ffq_i = \psi^{-1}(\ffa_{\ffp_i})$, where $\psi: R \to R_{\ffp_i}$ and $U = R \setminus \ffp_i$. So $\ffq_i$ is independent of choice of minimal decomposition.
        \item If $\Lambda = \langle \ffp_{i_1},\cdots,\ffp_{i_m} \rangle$ is an ``isolated'' subset of $\operatorname{Ass}(R) = \{\ffp_1,\cdots,\ffp_n\}$, then $\bigcap_{j=1}^{m} \ffq_{i_j} = \psi^{-1}(U^{-1}\ffa)$, where $\psi: R \to U^{-1}R$ and $U = R \setminus \{\ffp_{i_1},\cdots,\ffp_{i_n}\}$. So $\bigcap_{j=1}^{m}\ffq_{i_j}$ is independent of choice of minimal decomposition.
    \end{enumerate}
\end{theorem}


\begin{proof}
    \begin{enumerate}
        \item 
        \item \qedhere
    \end{enumerate}
\end{proof}

\begin{discussion}
    If $\ffm \in \operatorname{m-Spec}(R)$, then $\ffm^{n}$ is $\ffm$-primary for $n \geq 1$ by 4.11. If $\ffp = \langle X_{i_1}, \cdots, X_{i_m} \rangle \lneq k[X_1,\cdots,X_d]$, then $\ffp^{n}$ is $\ffp$-primary for $n \geq 1$.
    \begin{proof}
    \end{proof}
\end{discussion}

\begin{definition}
Let $\ffp \in \operatorname{Spec}(R)$ and $\psi: R \to R_\ffp$. Then for $n \geq 1$, the $n^{th}$ symbolic power of $\ffp$ is $\ffp^{n} = \psi^{-1}((\ffp^{n})_\ffp) = \psi^{-1}\left( \ffp_\ffp \right)^{n})$. 
\end{definition}

\begin{notation}
    $\ffp^{n} \subseteq \ffp^{(n)}$ because by 1.63(a), $\ffp^{n} \subseteq \psi^{-1}((\ffp^{n})_\ffp) = \ffp^{(n)}$.
\end{notation}

\begin{example}
    \begin{enumerate}
        \item 
            Let $\ffm \in \operatorname{m-Spec}(R)$ and $\psi: R \to R_\ffm$. By 4.37(b), $\ffm^{n} = \psi^{-1}((\ffm^{n})_\ffm) = \ffm^{(n)}$. since $\ffm^{n}$ is $\ffm$-primary and $\ffm \cap (R \setminus \ffp) = \emptyset$.
        \item Let $k$ be a field and $\ffp = \langle X_{i_1}, \cdots, X_{i_m} \rangle \lneq k[X_1,\cdots,X_d]$. Then $\ffp^{(n)} = \ffp^{n}$ for $n \geq 1$ (same proof as in (a) since $\ffp^{n}$ is $\ffp$-primary).
        \item Let $R = \frac{k[X,Y,Z]}{\langle XY-Z^{2} \rangle}$ and $\ffp = \langle \overbar{X}, \overbar{Z} \rangle$. $\ffp^{2} = \langle \overbar{X} \rangle \supsetneq \langle \overbar{X}^{2}, \overbar{X}\overbar{Z},\overbar{X} \overbar{Y} \rangle = \langle \overbar{X}^{2}, \overbar{X} \overbar{Z}, \overbar{Z}^{2} \rangle = \ffp^{2}$...
    \end{enumerate}
\end{example}

\begin{proposition}
    If $\ffp \in \operatorname{Spec}(R)$, then $\ffp^{(n)}$ is the ``$\ffp$-primary'' component of $\ffp^{n}$.
\end{proposition}
