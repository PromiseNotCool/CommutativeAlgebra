\chapter{Modules and Integral Dependence}

\section*{Modules}
\addcontentsline{toc}{section}{Modules}

Let $R$ be a commutative ring with identity.

\begin{definition}
    An \emph{$R$-module} is an additive abelian group $M$ equipped with a scalar multiplication $R \times M \to M$ denoted $(r,m) \mapsto rm$ that is unital, associative and distributive.
    \begin{itemize}
        \item $1m = m$ for all $m \in M$.
        \item $r(sm) = (rs)m$ for all $r,s \in R$ and $m \in M$.
        \item $(r+s)m = rm + sm$ for all $r,s \in R$ and $m \in M$.
        \item $r(m+n) = rm + rn$ for all $r \in R$ and $m,n \in M$.
    \end{itemize}
    \quad (Closure) $rm \in M$ for all $r \in R$ and $m \in M$. 
\end{definition}

\begin{example}
    \begin{enumerate}
        \item 
            For $n = 1,2,3,\cdots$, let $R^{n} = \left\{\begin{bmatrix}r_1 \\ \vdots \\ r_n\end{bmatrix}\mathrel{\Bigg |} r_1,\cdots,r_n \in R\right\}$ with $s \begin{bmatrix}r_1 \\ \vdots \\ r_n\end{bmatrix} = \begin{bmatrix}sr_1 \\ \vdots \\ sr_n\end{bmatrix}$ for $s \in R$, then $R^{n}$ is an $R$-module. e.g., $R$ is an $R$-module.
        \item A $\bbZ$-module is an additive abelian group.
        \item Let $\varphi: R \to S$ be a ring homomorphism. Then $S$ is an $R$-module with $r \cdot s = \varphi(r)s$ for $r \in R$ and $s \in S$.
    \end{enumerate}
\end{example}

\noindent Let $M$ be an $R$-module. 

\begin{definition}
    A \emph{submodule} of $M$ is a subset $N \subseteq M$ such that $N$ is an $R$-module using the operations from $M$.
\end{definition}

\begin{example}
    \begin{enumerate}
        \item If $I \leq R$, then $I$ is a submodule of $R$.
        \item A submodule of an $\bbZ$-module is a subgroup.
        \item Submodule test. $0 \neq N \subseteq M$ is a submodule of $M$ if and only if $n + n' \in N$ for all $n,n' \in N$ and $rn \in N$ for all $r \in R$ and $n \in N$ if and only if $n+rn' \in N$ for all $r \in R$ and $n,n' \in N$.
        \item If $M_\lambda \subseteq M$ is a submodule for $\lambda \in \Lambda$, then $\bigcap_{\lambda \in \Lambda} M_\lambda \subseteq M$ and $\sum_{\lambda \in \Lambda} M_\lambda \subseteq M$ are submodules.
    \end{enumerate}
\end{example}

\begin{definition}
    Let $Y \subseteq M$. Define
    \[\langle Y \rangle = R\langle Y \rangle = R(Y) = \bigcap_{Y \subseteq N \subseteq M}N,\]
    intersection of all submodules $N \subseteq M$ such that $Y \subseteq N$. This is the (unique) smallest submodule of $M$ containing $Y$. e.g., for a submodule $N \subseteq M$, $\langle Y \rangle \subseteq N$ if and only if $Y \subseteq N$. \par
    $\langle Y \rangle$ is the \emph{submodule} of $M$ generated by $Y$. \par 
    $M$ is \emph{finitely generated} if there exists $y_1,\cdots,y_n \in M$ such that $M = \langle y_1,\cdots,y_n \rangle$. 
\end{definition}

\begin{fact}
    \begin{enumerate}
        \item Let $Y \subseteq M$. Then $\langle Y \rangle = \{\sum_{y \in Y}^{\text{finite}} r_yy \mid r_y \in R, \fa y\} = \sum_{y \in Y} \langle y \rangle$.
        \item If $y_1,\cdots,y_n \in M$, then $\langle y_1,\cdots,y_n \rangle = \{\sum_{i=1}^{n} r_iy_i \mid r_1,\cdots,r_n \in R\}$
    \end{enumerate}
\end{fact}

\begin{example}
    Submodules of a finitely generated $R$-module may not be finitely generated. Note $R := k[X_1,X_2,\cdots] = \langle 1 \rangle$ is a finitely generated $R$-module, but $\ffm = \langle X_1,X_2,\cdots \rangle \subseteq R$ is not finitely generated.
\end{example}

\section*{Integral Dependence}
\addcontentsline{toc}{section}{Integral Dependence}

Let $R$ be a nonzero commutative ring with identity. Let $R \subseteq S$ be a subring.

\begin{definition}
    An element $s \in S$ is \emph{integral} over $R$ if there exists a monic $f \in R[X]$ such that $f(s) = 0$, i.e., there exists $n \geq 1$ and $r_0,\cdots,r_{n-1} \in R$ such that $s^{n} + r_{n-1}s^{n-1} + \cdots + r_0 = 0$. \par 
    $S$ is \emph{integral} $R$ if every $s \in S$ is integral over $R$, (or $R \subseteq S$ is an \emph{integral extension}).
\end{definition}

\begin{example}
    \begin{enumerate}
        \item Let $k \subseteq K$ be a field extension. Then $K$ is integral over $k$ if and only if $k \subseteq K$ is an algebraic extension. 
        \item Every $r \in R$ is integral over $R$ since $r$ satisfies $X-r \in R[X]$. 
        \item $\bbZ \subseteq \bbZ[i]$ is an integral extension since $a+bi \in \bbZ[i]$ satisfies $X^{2}-2aX+(a^{2}+b^{2}) \in \bbZ[X]$.
        \item $\bbZ \subseteq \bbQ$. The only $\frac{r}{s} \in \bbQ$ that are integral over $\bbZ$ are the elements of $\bbZ$.
    \end{enumerate}
\end{example}

\begin{proof}
    \begin{enumerate}
        \item[(c)] Let $\frac{r}{s} \in \bbQ$ be integral over $\bbZ$, where $s \neq 0$ and $(r,s) = 1$. Then $(\frac{r}{s})^{n} + c_{n-1} (\frac{r}{s})^{n-1} + \cdots + c_1(\frac{r}{s}) + c_0 = 0$ for some $n \geq 1$ and $c_0,\cdots,c_{n-1} \in R$. So $\frac{r^{n} + c_{n-1}r^{n-1}s + \cdots + c_1rs^{n-1} + c_0s^{n}}{s^{n}} = 0$, i.e., $r^{n} = -(c_{n-1}r^{n-1}s + \cdots + c_1r s^{n-1} + c_0s^{n}) = -s(c_{n-1}r^{n-1} + \cdots + c_1rs^{n-2} + c_0s^{n-1})$. Hence $s \mid r^{n}$. Since $(r,s) = 1$, $(r^{n},s) = 1$. So $s = \pm 1$. Thus, $\frac{r}{s} = \pm r \in \bbZ$. \qedhere
    \end{enumerate}
\end{proof}

\begin{definition}
    An \emph{intermediate subring} is a subring $T \subseteq S$ such that $R \subseteq T$. (Notice if $R \subseteq T \subseteq S$ is an intermediate subring, then $R \subseteq T$ is a subring.) \par
    Let $y_1,\cdots,y_n \in S$. Define the \emph{subring} of $S$ generated over $R$ by $y_1,\cdots,y_n$ by
    \[R[y_1,\cdots,y_n] = \bigcap_{\substack{R \subseteq T \subseteq S, \\ y_1,\cdots,y_n \in T}}T,\]
    where the intersection is taken over all intermediate subrings $R \subseteq T \subseteq S$ such that $y_1,\cdots,y_n \in T$. \par
\end{definition}

\begin{fact}
    Let $y_1,\cdots,y_n \in S$.
    \begin{enumerate}
        \item $R[y_1,\cdots,y_n] = \{f(y_1,\cdots,y_n) \in S \mid f \in R[Y_1,\cdots,Y_n]\}$.
        \item $\psi: R[Y_1,\cdots,Y_n] \to S$ given by $\psi(f) = f(y_1,\cdots,y_n)$ is a well-defined ring homomorphism with $\im(\psi) = R[y_1,\cdots,y_n]$ and $\overbar{Y_1},\cdots,\overbar {Y_n} \in R[Y_1,\cdots,Y_n]/\ker(\psi) \cong R[y_1,\cdots,y_n]$. So if $y_1,\cdots,y_n$ have no polynomial relations, $\ker(\psi) = 0$ and hence $R[Y_1,\cdots,Y_n] \cong R[y_1,\cdots,y_n]$.
        \item Let $T \subseteq S$ be a subring. Then $R[y_1,\cdots,y_n] \subseteq T$ if and only if $R \subseteq T$ and $y_1,\cdots,y_n \in T$.
    \end{enumerate}
\end{fact}

\begin{example}
    $\bbZ \subseteq \bbZ[i] \subseteq \bbC$ is an intermediate subring, where $\bbZ[i] \cong \bbZ[X]/\langle X^{2}+1 \rangle$.
\end{example}

\begin{proposition}
    Let $s \in S$. Then the followings are equivalent. 
    \begin{enumerate}
        \item[(i)] $s$ is integral over $R$.
        \item[(ii)] $R[s]$ is a finitely generated $R$-module.
        \item[(iii)] There exists an intermediate subring $R \subseteq T \subseteq S$ such that $s \in T$ and $T$ is a finitely generated $R$-module.
    \end{enumerate}
\end{proposition}

\begin{proof}
    ``(i)$\Rightarrow$(ii)''. Assume $s$ is integral over $R$. Then $s^{n} + r_{n-1} s^{n-1} + \cdots + r_0 = 0$ for some $n \geq 1$ and $r_0,\cdots,r_{n-1} \in R$. Claim. $R[s] = R\langle 1,s,\cdots,s^{n-1} \rangle$. ``$\supseteq$''. It is straightforward. ``$\subseteq$''. It suffices to show $s^{m} \in R\langle 1,s,\cdots,s^{n-1} \rangle$ for $m = n,n+1,\cdots$. Use induction on $m$. Base case: $s^{n} = -\sum_{i=0}^{n-1} r_is^{i} \in R\langle 1,s,\cdots,s^{n-1} \rangle$. Inductive step: asssume $m \geq n+1$ and $s^{k} \in R\langle 1,s,\cdots,s^{n-1} \rangle$ for $0 \leq k \leq m-1$. Then $s^{m} = s^{n} s^{m-n} = -\sum_{i=0}^{n-1}r_is^{i+m-n} \in R\langle s^{m-n},\cdots,s^{m-1}\rangle \subseteq R\langle 1,s,\cdots,s^{n-1} \rangle$ by inductive hypothesis. \par 
    ``(ii)$\Rightarrow$(iii)''. Use $T = R[s]$. \par 
    ``(iii)$\Rightarrow$(i)'' (determinant trick). Assume $s \in T = R\langle y_1,\cdots,y_n \rangle$ for some $y_1,\cdots,y_n \in S$. Then for $j = 1,\cdots,n$, $sy_j \in T$ and so there exist $a_{1j},\cdots,a_{nj} \in R$ such that $\sum_{i=1}^{n}\delta_{ij} sy_i = sy_j = \sum_{i=1}^{n}a_{ij}y_i$, i.e., $\sum_{i=1}^{n} (\delta_{ij}s - a_{ij}) y_i = 0$. Let $B = (\delta_{ij}s-a_{ij}) \in T^{n \times n}$. Then $B \vec y = \vec 0$. Let $(\delta_{ij}) \in T^{n \times n}$ be the identity matrix. Then $(\det(B)(\delta_{ij}))\vec y = \operatorname{adj}(B)B \vec y = \vec 0$, i.e., $\det(B)y_j = 0$ for $j = 1,\cdots,n$. Since $1 \in T = R\langle y_1,\cdots,y_n \rangle$, there exist $c_1,\cdots,c_n \in R$ such that $1 = \sum_{j=1}^{n}c_jy_j$. So $\det(\delta_{ij}s-a_{ij}) = \det(B) \cdot 1 = \det(B)\sum_{j=1}^{n}c_jy_j = \sum_{j=1}^{n} c_j\det(B)y_j = 0$, i.e., 
    \[0 = \det(\delta_{ij}s-a_{ij}) = 
        \abs{\begin{array}{cccc}
                s-a_{11}& -a_{12} & \cdots & -a_{1n} \\
                -a_{21} & s-a_{22} & \cdots & -a_{2n} \\
                \vdots & \vdots & \ddots \vdots \\
                -a_{n1} & -a_{n2} & \cdots & s-a_{nn}
             \end{array}} = s^{n} + c_{n-1}s^{n-1} + \cdots + c_1s + c_0,\]
             where $c_0,\cdots,c_{n-1} \in R$ since they are built from $a_{ij}\text{'}s \in R$.
\end{proof}

\begin{theorem}
    If $s_1,\cdots,s_n \in S$ are integral over $R$, then $R[s_1,\cdots,s_n]$ is a finitely generated $R$-module. 
\end{theorem}

\begin{proof}
    Assume $B = A\langle b_1,\cdots,b_m \rangle$ and $C = B\langle c_1,\cdots,c_n \rangle$ with $A \subseteq B \subseteq C$ an intemediate subring. Claim. $C = A \langle b_ic_j \mid i = 1,\cdots,m, j = 1,\cdots,n\rangle$. ``$\supseteq$''. It is straightforward. ``$\subseteq$''. Let $c \in C$. Then $c = \sum_{j=1}^{n} \beta_jc_j$ for some $\beta_1,\cdots,\beta_n \in B$. Note for $j = 1,\cdots,n$, $\beta_j = \sum_{i=1}^{m} \alpha_{ij}b_i$ for some $\alpha_{1j},\cdots,\alpha_{mj} \in A$. So $c = \sum_{j=1}^{n}(\sum_{i=1}^{m}\alpha_{ij}b_i)c_j = \sum_{i=1}^{m}\sum_{j=1}^{n} \alpha_{ij}b_ic_j$. \par
    Since $s_1$ is integral over $R$, by Proposition 5.13, $R[s_1]$ is a finitely generated $R$-module. Since $s_2$ is integral over $R$, clearly $s_2$ is integral over $R[s_1]$ and then $R[s_1,s_2] = R[s_1][s_2]$ is a finitely generated $R[s_1]$-module. So $R[s_1,s_2]$ is a finitely generated $R$-module by our result. Continuing in this fashion, we have $R[s_1,\cdots,s_n]$ is a finitely generated $R$-module.
\end{proof}

\begin{theorem}
    Let $\overbar{R} := \{s \in S \mid s \text{ is integral over }R\}$. Then $R \subseteq \overbar{R} \subseteq S$ is an intermediate subring. So for $s,s' \in S$ integral over $R$, the elements $s \pm s'$ and $ss'$ are integral over $R$.
\end{theorem}

\begin{proof}
    $R \subseteq \overbar{R}$ is straightforward. Since $s,s'$ are integral over $R$, $T := R[s,s']$ is a finitely generated $R$-module by Theorem 5.14. So $s \pm s',ss'$ are integral over $R$ by Proposition 5.13(iii). Hence $s \pm s', ss' \in \overbar{R}$. Since $R \subseteq S$ is a subring, $1_S = 1_R \in \overbar{R}$. So by subring test, $\overbar{R} \subseteq S$ is a subring. 
\end{proof}

\begin{note*}
    Let $s,s' \in R$ be integral over $R$. Assume $s,s'$ satisfies a monic $f,g \in R[X]$ of degree $m,n$, respectively. Since $s'$ also satisfies the monic $g \in R[s][X]$ of degree $n$, by the proof ``(i)$\Rightarrow$(ii)'' of Proposition 5.13, we have
    \begin{align*}
        R[s,s'] &= R[s][s'] = R[s]\langle 1,s',\cdots,s'^{n-1} \rangle = R\langle 1,s,\cdots,s^{m-1} \rangle \langle 1,s',\cdots,s'^{n-1} \rangle \\
        &= R\langle 1,s',\cdots,s'^{n-1},s,ss',\cdots,ss'^{n-1},\cdots,s^{m-1},s^{m-1}s',s^{m-1}s'^{n-1} \rangle,
    \end{align*}
    which has $mn$ generators. Hence by the proof ``(iii)$\Rightarrow$(i)'' of Proposition 5.13, we have all elements in $R[s,s']$, e.g., $s \pm s,ss'$ satisfy a monic polynomial of degree $mn$ in $R[X]$.
\end{note*}

\begin{definition}
    $\overbar{R} = \{s \in S \mid s \text{ is integral over }R\}$ is the \emph{integral closure} of $R$ in $S$. \par 
    If $\overbar{R} = S$, then $S$ is \emph{integral} over $R$. If $\overbar{R} = R$, then $R$ is \emph{integrally closed} in $S$.
\end{definition}

\begin{example}
    \begin{enumerate}
        \item $\bbZ[i]$ is integral over $\bbZ$ with $\overbar{\bbZ} = \bbZ[i]$.
        \item $\bbZ$ is integrally closed in $\bbQ$ with $\overbar{\bbZ} = \bbZ$. 
        \item $\overbar{\bbZ} = \bbZ[i]$ in $\bbQ(i)$.
    \end{enumerate}
\end{example}

\begin{definition}
    Let $\varphi: R \to S$ be a ring homomorphism. Then $\varphi$ is \emph{integral} if $\im(\varphi) \subseteq S$ is an integral extension.
\end{definition}

\begin{theorem}
    The followings are equivalent.
    \begin{enumerate}
        \item[(i)]
            $S$ is a finitely generated $R$-module.
        \item[(ii)]
            $S = R[s_1,\cdots,s_n]$ for some $s_1,\cdots,s_n$ and is integral over $R$. 
        \item[(iii)] $S = R[s_1,\cdots,s_n]$ for some $s_1,\cdots,s_n$ integral over $R$.
    \end{enumerate}
\end{theorem}

\begin{proof}
    ``(i)$\Rightarrow$(ii)''. Assume $S = R\langle s_1,\cdots,s_n \rangle$. Then $S = R\langle s_1,\cdots,s_n \rangle \subseteq R[s_1,\cdots,s_n] \subseteq S$. So $S = R[s_1,\cdots,s_n]$. Note there exists an intermediate subring $R \subseteq R[s_1,\cdots,s_n] := T \subseteq S$ such that $T$ is a finitely generated $R$-module. Then $s_1,\cdots,s_n \in S$ are integral over $R$ by Proposition 5.13. Since $\overbar{R} \subseteq S$ is a subring by Theorem 5.15, $S = R[s_1,\cdots,s_n] \subseteq \overbar{R} \subseteq S$ by Fact 5.11(c). So $\overbar{R} = S$. \par
    ``(ii)$\Rightarrow$(iii)''. Done. \par 
    ``(iii)$\Rightarrow$(i)''. By Theorem 5.14.
\end{proof}


\begin{corollary}
    If $R \subseteq S$ and $S \subseteq T$ are integral extensions, then $R \subseteq T$ is an integral extension.
\end{corollary}

\begin{proof}
    Let $t \in T$. Then $t$ is integral over $S$. So $t^n + s_{n-1} t^{n-1} + \cdots + s_0 = 0$ for some $n \geq 1$ and $s_0,\cdots,s_{n-1} \in S$. So $t$ is integral over $R[s_0,\cdots,s_{n-1}]$. Hence $R[s_0,\cdots,s_{n-1},t] = R[s_0,\cdots,s_{n-1}][t]$ is a finitely generated $R[s_0,\cdots,s_{n-1}]$-module by Proposition 5.13. Since $S$ is integral over $R$ and $s_0,\cdots,s_{n-1} \in S$, $s_0,\cdots,s_{n-1}$ are integral over $R$. So $R[s_0,\cdots,s_{n-1}]$ is a finitely generated $R$-module by Theorem 5.14. Thus, $R[s_0,\cdots,s_{n-1},t]$ is a finitely generated $R$-module by the claim in the proof of Theorem 5.14. Therefore, $t$ is integral over $R$ by Proposition 5.13(iii).
\end{proof}

\begin{corollary}
    If $\overbar{R}$ is an integral closure of $R$ in $S$, then $\overbar{R}$ is integrally closed in $S$, i.e., ${\overbar{\overbar{R}}} = \overbar{R}$.
\end{corollary}

\begin{proof}
    Let $s \in \overbar{\overbar{R}}$. Then $s \in S$ be integral over $\overbar{R}$. So $R \subseteq \overbar{R} \subseteq \overbar{R}[s]$ are integral extensions by Theorem 5.15. Hence $R \subseteq \overbar{R}[s]$ is an integral extension by Corollary 5.20. So $s$ is integral over $R$, i.e., $s \in \overbar{R}$.
\end{proof}

\begin{proposition}
    Let $R \subseteq S$ be an integral extension.
    \begin{enumerate}
        \item If $\ffb \leq S$ and $\ffa = R \cap \ffb$, then $R/\ffa \to S/\ffb$ given by $r+\ffa \mapsto r+\ffb$ is 1-1 and integral. 
        \item If $U \subseteq R$ is multiplicatively closed, then $U^{-1}R \subseteq U^{-1}S$ given by $\frac{r}{u} \mapsto \frac{r}{u}$ is an integral extension.
    \end{enumerate}
\end{proposition}

\begin{proof}
    \begin{enumerate}
        \item Consider
            \begin{center}
                \begin{tikzcd}
                    &[-20pt] R \ar[r,"\subseteq"] \ar[r,swap,"p"] \ar[d,"\tau"] \ar[rd,swap,"\rho"] & S \ar[d,"\pi"] &[-20pt] \\
                    & R/\ffa \ar[r,dashed,swap,hook,"\ex !\ \overbar{\rho}"] & S/\ffb \\ [-20pt]
                    \overbar{r} \ar[rrr,mapsto] & & & \overbar{r}
                \end{tikzcd}
            \end{center}
            Since $\ker(\rho) = \ker(\pi) \cap R = \ffb \cap R = \ffa$, by the first isomorphism, $R/\ffa \cong \im(\overbar{\rho}) \subseteq S/\ffb$. \par 
            Let $\overbar{s} \in S/\ffb$. Then $s$ is integral over $R$ since $S$ is integral over $R$. So $s$ satisfies $X^{n} + \sum_{i=0}^{n-1}a_iX^{i}$ for some $a_0,\cdots,a_{n-1} \in R$. Hence $\overbar{s}$ satisfies $X^{n} + \sum_{i=0}^{n-1} \overbar{a}_iX^{i}$ for some $\overbar{a}_0,\cdots,\overbar{a}_{n-1} \in R/\ffa \cong \im(\overbar{\rho})$.
        \item Let $\frac{s}{u} \in U^{-1}S$ with $s \in S$ and $u \in U$. Then $s$ is integral over $R$. So $s^{n} + a_{n-1}s^{n-1} + \cdots + a_0 = 0$ for some $a_0,\cdots,a_{n-1} \in R$. Hence $0 = \frac{s^{n}+a_{n-1}s^{n-1} + \cdots + a_1s + a_0}{u^{n}} = (\frac{s}{u})^{n} + (\frac{a_{n-1}}{u})(\frac{s}{u})^{n-1} + \cdots + (\frac{a_1}{u^{n-1}})(\frac{s}{u}) + (\frac{a_0}{u^{n}})$ for some $\frac{a_0}{u^{n}},\frac{a_1}{u^{n-1}},\cdots,\frac{a_{n-1}}{u} \in U^{-1}R$. \qedhere
    \end{enumerate}
\end{proof}

\begin{discussion}
    Let $\ffp \in \operatorname{Spec}(R)$. When does there exist $\ffq \in \operatorname{Spec}(S)$ such that $\ffp = \ffq \cap R$? i.e., when is the induced map $\operatorname{Spec}(S) \to \operatorname{Spec}(R)$ surjective? \par 
    By Cohen-Seidenberg, it is a surjection when $S$ is integral over $R$.
\end{discussion}

\noindent Let $R \subseteq S$ be an integral extension.

\begin{proposition}
    Let $S$ be an integral domain. Then $R$ is a field if and only if $S$ is a field.
\end{proposition}

\begin{proof}
    ``$\Rightarrow$''. Assume $R$ is a field. Let $0 \neq s \in S$. Then $s$ is integral over $R$ since $S$ is integral over $R$. So there exists $n := \min\{\deg(f) \mid s \text{ satisfies a monic }f \in R[X]\}$. Then $s^{n} + a_{n-1}s^{n-1} + \cdots + a_0 = 0$ for some $a_0,\cdots,a_{n-1} \in R$. Suppose $a_0 = 0$. Then $s(s^{n-1} + \cdots + a_1) = 0$. Since $s \neq 0$ and $S$ is an integral domain, $s^{n-1} + \cdots +a_1 = 0$, contradicting the minimality of $n$. So $a_0 \neq 0$. Since $R$ is a field, $a_0 \in R^{\times} \subseteq S^{\times}$. Hence $s(s^{n-1} + \cdots + a_1) = -a_0 \in S^{\times}$. Thus, $s \in S^{\times}$. \par 
    ``$\Leftarrow$''. Assume $S$ is a field. Let $0 \neq r \in R \subseteq S$. Then $r^{-1} \in S$. Note $r^{-1}$ is integral over $R$ since $S$ is integral over $R$. Then $r^{n-1}[(r^{-1})^{n} + a_{n-1}(r^{-1})^{n-1} + \cdots + a_1(r^{-1}) + a_0] = 0$ for some $a_0,a_1,\cdots,a_{n-1} \in R$. So $r^{-1} + \smallunderbrace{a_{n-1} + \cdots + a_1r^{n-2} + a_0r^{n-1}}_{\in R} = 0$. Hence $r^{-1} \in R$.
\end{proof}

\begin{example*}
    Conclusion of Proposition 5.24 fails if $S$ is not an integral domain. Let $k$ be a field . Restrict the domain of the projection $\varphi: k[X] \to k[X]/(X^{2})$, we have an induced ring homomorphism $\varphi|_k: k \to k[X]/(X^{2})$. Since $\varphi|_k(1) = \overbar{1} \neq 0$ in $k[X]/(X^{2})$, $\varphi|_k \neq 0$. Also, since $k$ is a field, $\varphi|_k$ is 1-1. So we regard $R := k$ as a subring of $S := k[X]/(X^{2})$. Let $x = \overbar{X} \in S$. Then $x$ is integral over $k$ since $x^{2} = 0$. So $S = k[x]$ is integral over $k$. However, $R$ is a field but $S$ is not a field.  \par
    Let $\epsilon \neq 0$ and $\epsilon^{2} = 0$ in a ring extension $T \supseteq k$, then $\varphi: k[X] \to k[\epsilon]$ given by $f \mapsto f(\epsilon)$ is a ring epimorphism with $\ker(\varphi) = (X^{2})$, so $k[X]/(X^{2}) \cong k[\epsilon] = k\epsilon + k$.
\end{example*}

\begin{corollary}
    Let $\ffq \in \operatorname{Spec}(S)$ and $\ffp = \ffq \cap R$. Then $\ffp \in \operatorname{m-Spec}(R)$ if and only if $\ffq \in \operatorname{m-Spec}(S)$. 
\end{corollary}

\begin{proof}
    Since $S$ is integral over $R$, $R/\ffp \subseteq S/\ffq$ is an integral extension by Proposition 5.22(a). Since $S/\ffq$ is an integral domain, by Proposition 5.24, $R/\ffp$ is a field if and only if $S/\ffq$ is a field.
\end{proof}

\begin{theorem}
    $\operatorname{Spec}(S) \to \operatorname{Spec}(R)$ given by $\ffq \mapsto \ffq \cap R$ is a surjection, i.e., for $\ffp \in \operatorname{Spec}(R)$, there exists $\ffq \in \operatorname{Spec}(S)$ such that $\ffp = \ffq \cap R$.
\end{theorem}

\begin{proof}
    Let $U = R \setminus \ffp$. Consider
    \begin{center}
        \begin{tikzcd}
            &[-29pt] \ffp &[-30pt] & &[-20pt] \\ [-15pt]
            & & R \ar[r,"\subseteq"] \ar[d,"\psi"] & S \ar[d,"\rho"] & \\
            & & U^{-1}R \ar[r,"\subseteq"] & U^{-1}S \\ [-20pt]
            \ffp_\ffp= & R_\ffp \cap Q \ar[uuu,mapsto] & & & Q \ar[mapsto,lll]
        \end{tikzcd}
    \end{center}
    Since $R \subseteq S$ is an integral extension, $U^{-1}R \subseteq U^{-1}S$ is an integral extension by Proposition 5.22(b). Since $0 \neq R \subseteq S$, $0 \neq R_\ffp = U^{-1}R \subseteq U^{-1}S$. So there exists $Q \in \operatorname{m-Spec}(U^{-1}S)$. By Corollary 5.25, $Q \cap R_\ffp\in \operatorname{m-Spec}(R_\ffp) = \{\ffp_\ffp\}$ by Corollary 3.14. So $Q \cap R_\ffp = \ffp_\ffp$. Consider $\psi: R \to U^{-1}R$. Since $U \cap \ffp = \emptyset$, by Proposition 3.13, we have $\ffp \cdot U^{-1}(U^{-1}R) = \ffp \cdot U^{-1}R \neq U^{-1}R = U^{-1}(U^{-1}R)$. So by Theorem 3.24, $\ffp = \psi^{-1}(\ffp \cdot U^{-1}R) = \psi^{-1}(\ffp_\ffp) = \psi^{-1}(Q \cap R_\ffp) = \rho^{-1}(Q) \cap R$. Let $\ffq := \rho^{-1}(Q)$. Since $Q \in \operatorname{Spec}(U^{-1}S)$, $\ffq \in \operatorname{Spec}(S)$ by Fact 1.16.
\end{proof}

\begin{proposition}
    Let $\ffq,\ffq' \in \operatorname{Spec}(S)$ such that $\ffq \cap R = \ffq' \cap R$. Then $\ffq \subseteq \ffq'$ if and only if $\ffq = \ffq'$.
\end{proposition}

\begin{proof}
    Let $\ffp = \ffq \cap R = \ffq' \cap R \in \operatorname{Spec}(R)$ by Fact 1.16. Let $U = R \setminus \ffp$. By prime correspondence for localization, $\operatorname{Spec}(U^{-1}S) \leftrightarrow \{\gamma \in \operatorname{Spec}(S) \mid \gamma \cap (R\setminus \ffp) = \emptyset\} = \{\gamma \in \operatorname{Spec}(S) \mid \gamma \cap R \subseteq \ffp\}$ given by $U^{-1}\gamma \mapsfrom \gamma$. So $U^{-1}\ffq,U^{-1}\ffq' \in \operatorname{Spec}(U^{-1}S)$. 
    \begin{center}
        \begin{tikzcd}
            \ffp \ar[ddd,mapsto] &[-25pt] & &[-40pt] \ffq,\ffq' \ar[lll,mapsto] \ar[ddd,mapsto] \\ [-20pt]
            & R \ar[r,"\subseteq"] \ar[d,"\psi"] & S \ar[d,"\rho"] \\
            &U^{-1}R \ar[r,"\subseteq"] & U^{-1}S \\ [-20pt]
            \ffp_\ffp & & & U^{-1}\ffq, U^{-1}\ffq' 
        \end{tikzcd}
    \end{center}
    Since $U^{-1}\ffq, U^{-1}\ffq' \supseteq U^{-1}\ffp = \ffp_\ffp$ and $R_\ffp \supsetneq \ffp_\ffp$, we have $U^{-1}\ffq \cap R_\ffp, U^{-1}\ffq' \cap R_\ffp \supsetneq \ffp_\ffp \in \operatorname{m-Spec}(R_\ffp)$. So $U^{-1}\ffq \cap R_\ffp = \ffp_\ffp = U^{-1}\ffq' \cap R_\ffp$.\footnote[2]{$U^{-1}\ffq \cap R_\ffp = U^{-1}\ffq \cap U^{-1}R = U^{-1}(\ffq \cap R) = U^{-1}\ffp = \ffp_\ffp = U^{-1}\ffp = U^{-1}(\ffq' \cap R) = U^{-1}\ffq' \cap U^{-1}R = U^{-1}\ffq' \cap R_\ffp$.} Since $R \subseteq S$ is an integral extension, $U^{-1}R \subseteq U^{-1}S$ is an integral extension by Proposition 5.22(b). So by Corollary 5.25, $U^{-1}\ffq,U^{-1}\ffq' \in \operatorname{m-Spec}(U^{-1}S)$. Also, since $U^{-1}\ffq \subseteq U^{-1}\ffq'$, $U^{-1}\ffq = U^{-1}\ffq'$. Thus, $\ffq = \ffq'$ by the prime correspondence for localization.
\end{proof}

\begin{theorem}[Going up theorem]
    Let $\ffp_1 \subseteq \cdots \subseteq \ffp_n$ be a chain in $\operatorname{Spec}(R)$ and $\ffq_1 \subseteq \cdots \subseteq \ffq_m$ ($m < n$) be a chain in $\operatorname{Spec}(S)$ such that $\ffp_i = \ffq_i \cap R$ for $i = 1,\cdots,m$. Then there exists a chain $\ffq_\ffm \subseteq \cdots \subseteq \ffq_n$ in $\operatorname{Spec}(S)$ such that $\ffq_i \cap R = \ffp_i$ for $i = 1,\cdots,n$.
\end{theorem}

\begin{proof}
    By induction on $n-m$. It suffices to consider the case $n = 2$ and $m = 1$. Need to find $\ffq_2 \in \operatorname{V}(\ffq_1) \subseteq \operatorname{Spec}(S)$ such that $\ffq_2 \cap R = \ffp_2$. Consider
    \begin{center}
        \begin{tikzcd}
            \ffp_2 &[-33pt] & &[-33pt] \ffq_2 \ar[mapsto,lll] \\ [-17pt]
            & R \ar[r,swap,"\subseteq"] \ar[d,"\pi"] & S \ar[d,swap,"\tau"] \\
            & R/\ffp_1\ar[r,"\subseteq"] & S/\ffq_1 \\ [-17pt]
            \ffp_2/\ffp_1 \ar[uuu,mapsto] & & & \ffq_2/\ffq_1 \ar[uuu,mapsto] \ar[lll,mapsto] 
        \end{tikzcd}
    \end{center}
    Since $R \subseteq S$ is an integral extension and $\ffp_1 = \ffq_1 \cap R$, by Proposition 5.22(a), $R/\ffp_1 \subseteq S/\ffq_1$ is an integral extension. Also, since $\ffp_2/\ffp_1 \in \operatorname{Spec}(R/\ffp_1)$ by prime correspondence for quotients, there exists $\ffq_2/\ffq_1 \in \operatorname{Spec}(S/\ffq_1)$ such that $(\ffq_2/\ffq_1) \cap (R/\ffp_1) = \ffp_2/\ffp_1$ by Theorem 5.26. \par 
    Note $x + \ffp_1 \in (R \cap \ffq_2)/\ffp_1$ if and only if $x \in R$ and $x \in \ffq_2$ if and only if $x + \ffq_1 = x + \ffp_1 \in (\ffq_2/\ffq_1) \cap (R/\ffp_1) = \ffp_2/\ffp_1$ since we can regard $R/\ffp_1 \subseteq S/\ffq_1$.by Proposition 5.22(a). So $(\ffq_2 \cap R)/\ffp_1 = \ffp_2/\ffp_1$. Thus, $\ffq_2 \cap R = \ffp_2$ by prime correspondence for quotients.
\end{proof}

\begin{example}
    Integral assumption is crucial.
    \begin{enumerate}
        \item $\bbZ \subseteq \bbQ$. Let $0 \subseteq 2\bbZ$ be a chain in $\operatorname{Spec}(\bbZ)$, Note $0$ is a (unique) chain in $\operatorname{Spec}(\bbQ) = \{0\}$.
        \item $\bbZ \subseteq \bbZ[X]$. Let $0 \subseteq 2\bbZ$ be a chain in $\operatorname{Spec}(\bbZ)$ and $\langle 2X-1 \rangle$ be a chain in $\operatorname{Spec}(\bbZ[X])$ since $\frac{\bbZ[X]}{(2X-1)} \cong \bbZ_2\footnote[2]{$\bbZ_2$ is the localization of $\bbZ$ away from $2$ while $\bbZ_{(2)}$ is the localization of $\bbZ$ at $2$.} = \bbZ[\frac{1}{2}] \subseteq \bbQ$ given by $\overbar{X} \mapsto \frac{1}{2}$ and $\bbZ[\frac{1}{2}]$ is an integral domain. Note $\bbZ \cap \langle 2X-1 \rangle = 0$. Suppose there exists $Q \in \operatorname{Spec}(\bbZ[X])$ such that $\langle 2X-1 \rangle \subseteq Q$ and $\bbZ \cap Q = 2\bbZ$. Then $2,2x-1 \in Q$. So $1 \in Q$, i.e., $Q = \bbZ[X]$, a contradiction. \par
            This example also shows the need for integral assumption in Proposition 5.27 because 
            \begin{enumerate}
                \item 
                    $0,\langle 2X-1 \rangle \in \operatorname{Spec}(\bbZ[X])$ and $\bbZ \cap 0 = 0 = \bbZ \cap \langle 2X-1 \rangle$, but $0 \subsetneq \langle 2X-1 \rangle$;
                \item 
                    $\langle 2 \rangle, \langle 2,X \rangle \in \operatorname{Spec}(\bbZ[X])$ and $\bbZ \cap \langle 2 \rangle = 2\bbZ = \bbZ \cap \langle 2,X \rangle$, but $\langle 2 \rangle \subsetneq \langle 2,X \rangle$.
            \end{enumerate}
    \end{enumerate}
\end{example}

\begin{proposition}
    Let $U \subseteq R$ be multiplicatively closed. Let $\overbar{R}$ be the integral closure of $R$ in $S$ and $\overbar{U^{-1}R}$ be the integral closure of $U^{-1}R$ in $U^{-1}S$. Then $\overbar{U^{-1}R} = U^{-1} \overbar{R}$.
\end{proposition}

\begin{proof}
    ``$\supseteq$''. Since $R \subseteq \overbar{R} \subseteq S$ with $R \subseteq \overbar{R}$ integral, we have $U^{-1}R \subseteq U^{-1}\overbar{R} \subseteq U^{-1}S$ with $U^{-1}R \subseteq U^{-1}\overbar{R}$ integral by Proposition 5.22(b). So $U^{-1} \overbar{R} \subseteq \overbar{U^{-1}R}$. \par 
    ``$\subseteq$''. Let $\frac{s}{u} \in \overbar{U^{-1}R} \subseteq U^{-1}S$. Then $0 = (\frac{s}{u})^{n} + (\frac{a_{n-1}}{v_{n-1}})(\frac{s}{u})^{n-1} + \cdots + (\frac{a_1}{v_1})(\frac{s}{u}) + (\frac{a_0}{v_0})$ in $U^{-1}S$ for some $a_0,\cdots,a_{n-1} \in R$ and $v_0,\cdots,v_{n-1} \in U$. Let $v := v_0 \cdots v_{n-1} \in U$ and multiply the equation by $(uv)^{n}$, $0 = (vs)^{n} + (\smallunderbrace{u\frac{v}{v_{n-1}}a_{n-1}}_{b_{n-1} \in R})(vs)^{n-1} + \cdots + (\smallunderbrace{u^{n-1} \frac{v^{n-1}}{v_1}a_1}_{b_1 \in R})(vs) + (\smallunderbrace{u^{n}\frac{v^{n}}{v_0}a_0}_{b_0 \in R})$ in $U^{-1}R$. So there exists $w \in U \subseteq R$ such that $0 = w^n \cdot 0 = (wvs)^{n} + (\smallunderbrace{wb_{n-1}}_{\in R})(wvs)^{n-1} + \cdots + (\smallunderbrace{w^{n-1}b_1}_{\in R})(wvs) + (\smallunderbrace{w^{n}b_0}_{\in R})$. Hence $wvs \in \overbar{R}$. Thus, $\frac{s}{u} = \frac{wvs}{wvu} \in U^{-1}\overbar{R}$.
\end{proof}

\begin{definition}
    If $R$ is an integral domain, then $R$ is \emph{integrally closed} if it is integrally closed in field of fraction $Q(R)$. 
\end{definition}

\begin{example}
    \begin{enumerate}
        \item $\bbZ$ is integrally closed.
        \item Any UFD is integrally closed.
        \item Let $R := k[X^{2},XY,Y^{2}] \subseteq k[X,Y]$. Then $R$ is not a UFD since $X^{2}Y^{2} = (XY)(XY)$ with $X^{2},Y^{2},XY$ irreducible in $R$. \par 
            Note $Q(R) = k(X,Y) = Q(k[X,Y])$. Since $X,Y$ satisfies $Z^{2}-X^{2},Z^{2}-Y^{2} \in R[Z]$, respectively, we have $X,Y$ are integral over $R$. Also, since $k$ is integral over $R$, $R \subseteq k[X,Y]$ is integral. Since $k[X,Y]$ is a UFD, $k[X,Y]$ is integrally closed by (b). Hence $R$ is integrally closed by Corollary 5.20. \par 
            Claim. $R \cong \frac{k[U,V,W]}{\langle V^{2}-UW \rangle}$. Let $\varphi: k[U,V,W] \to k[X,Y]$ be a ring homomorphism given by $U \mapsto X^{2}$, $V \mapsto XY$ and $W \mapsto Y^{2}$. Then $\im(\varphi) = k[X^{2},XY,Y^{2}]$ and $\langle V^{2}-UW \rangle \subseteq \ker(\varphi)$. Let $f \in \ker(\varphi)$. Then by the division algorithm, $f = (V^{2}-UW)q + r$ for some $q,r \in k[U,W][V]$ and $\deg(r) < 2$ in $k[U,W][V]$. Since $\varphi(f) = 0$ and $\varphi$ is a ring homomorphism, $((XY)^{2}-X^{2}Y^{2})\varphi(q) + \varphi(r)=0$, i.e., $\varphi(r) = 0$. Note $r = aV+b$ for some $a,b\in k[U,W]$. So $a(X^{2},Y^{2})XY + b(X^{2},Y^{2}) = 0$. Hence $a= 0 = b$, i.e., $r = 0$. So $f \in \langle V^{2}-UW \rangle$. 
    \end{enumerate}
\end{example}

\begin{example*}
    If $S$ is noetherian, then $R$ is not necessarily noetherian. Let $\overbar{\bbQ}$ be the algebraic closure of $\bbQ$ in $\bbC$ and $R := \bbQ + X \overbar{\bbQ}[X] \subseteq \overbar{\bbQ}[X] =: S$. Note $R \subseteq S$ is an integral extension since $\overbar{\bbQ}$ is algebraic over $\bbQ \subseteq R$ and $X \in R$, but $R$ is not noetherian since $[\overbar{\bbQ}:\bbQ] = \infty$.
\end{example*}

\begin{lemma}
    If $R$ is an integral domain, then $R = \bigcap_{\ffm \in \operatorname{m-Spec}(R)} R_\ffm \subseteq Q(R)$. 
\end{lemma}

\begin{proof}
    ``$\subseteq$''. Since $R$ is an integral domain, we have $R \setminus \ffm \subseteq \operatorname{NZD}(R)$. So $R \subseteq R_\ffm \subseteq Q(R)$ for $\ffm \in \operatorname{m-Spec}(R)$. Hence $R \subseteq \bigcap_{\ffm \in \operatorname{m-Spec}(R)}R_\ffm \subseteq Q(R)$. \par 
    ``$\supseteq$''. Let $x \in \bigcap_{\ffm \in \operatorname{m-Spec}(R)}R_\ffm$. Let $I = \{r \in R \mid rx \in R\} =: (R:_Rx) \leq R$. By Proposition 3.12(f), $I_\ffm = (R:_Rx)_\ffm = (R_\ffm:_{R_\ffm}x) = R_\ffm$ for $\ffm \in \operatorname{m-Spec}(R)$. So $I \cap (R \setminus \ffm) \neq \emptyset$, i.e., $I \not\subseteq \ffm$ for $\ffm \in \operatorname{m-Spec}(R)$. Hence $I = R$, i.e., $1 \in I = (R:_Rx)$. Thus, $x = 1 \cdot x \in R$. 
\end{proof}

\begin{proposition}[being integrally closed is a ``local condition'']
    Let $R$ be an integral domain. Then the followings are equivalent.
    \begin{enumerate}
        \item[(i)] $R$ is integrally closed.
        \item[(ii)] $U^{-1}R$ is integrally closed for multiplicatively closed $U \subseteq R$ with $0 \not \in U$.
        \item[(iii)] $R_\ffp$ is integrally closed for $\ffp \in \operatorname{Spec}(R)$.
        \item[(iv)] $R_\ffm$ is integrally closed for $\ffm \in \operatorname{m-Spec}(R)$.
    \end{enumerate}
\end{proposition}

\begin{proof}
    ``(i)$\Rightarrow$(ii)''. Assume $R$ is integrally closed. Let $U \subseteq R$ be multiplicatively closed with $0 \not \in U$. Since $R$ is an integral domain and $0 \not\in U$, $U \subseteq \operatorname{NZD}(R)$. So $R \subseteq U^{-1}R \subseteq Q(R) =: S$ are subrings. By Proposition 5.30, $\overbar{U^{-1}R} = U^{-1} \overbar{R} = U^{-1}R$ since $R$ is integral closed in $Q(R)$. So $U^{-1}R$ is integrally closed in $U^{-1}S = Q(R)$. Also, since $Q(U^{-1}R) = Q(R)$\footnote[2]{Fact: If $R$ is an integral domain and $R \subseteq S \subseteq Q(S)$, then $Q(S) = Q(R)$.}, $U^{-1}R$ is integrally closed. \par 
    ``(ii)$\Rightarrow$(iii)'' and ``(iii)$\Rightarrow$(iv)''. Done. \par
    ``(iv)$\Rightarrow$(i)''. Assume $R_\ffm$ is integrally closed for $\ffm \in \operatorname{m-Spec}(R)$. Since $R$ is an integral domain and $R \subseteq R_\ffm \subseteq Q(R)$, $Q(R_\ffm) = Q(R)$ for $\ffm \in \operatorname{m-Spec}(R)$. Let $x \in \overbar{R}$, where $\overbar{R}$ is the integral closure of $R$ in $Q(R)$. Then $x \in Q(R) = Q(R_\ffm)$ and $x$ is integral over $R \subseteq R_\ffm$ for $\ffm \in \operatorname{m-Spec}(R)$. So $x \in \overbar{R_\ffm} = R_\ffm$ for $\ffm \in \operatorname{m-Spec}(R)$. Thus, by Lemma 5.33, $x \in \bigcap_{\ffm \in \operatorname{m-Spec}(R)}R_\ffm = R$. 
\end{proof}

\noindent Let $R \subseteq $ be a subring.

\begin{definition}
    Let $\ffa \leq R$. $s \in S$ is \emph{integral over $\ffa$} if $s$ satisfies $f(X) = X^{n} + a_{n-1}X^{n-1} + \cdots + a_0$ for some $n \geq 1$ and $a_0,\cdots,a_{n-1} \in \ffa$. \par 
    The \emph{integral closure} of $\ffa$ in $S$ is 
    \[\overbar{\ffa} = \{s \in S \mid s \text{ is integral over $\ffa$}\}.\]
\end{definition}

\begin{warning}
    There exists another notion of integral closure of an ideal.
\end{warning}

\begin{lemma}
    Let $\overbar{R}$ be the integral closure of $R$ in $S$ and $\ffa \leq R$. Then $\overbar{\ffa} = \operatorname{rad}(\ffa \overbar{R}) \leq \overbar{R}$. So $\overbar{\ffa}$ is closed under sums and products.
\end{lemma}

\begin{proof}
    ``$\subseteq$''. Let $s \in \overbar{\ffa}$. Then $s^{n} + a_{n-1}s^{n-1} + \cdots + a_0 = 0$ for some $n \geq 1$ and $a_0,\cdots,a_{n-1} \in \ffa$. So $s^{n} = -(a_{n-1}s^{n-1} + \cdots + a_0) \in \ffa \overbar{\ffa} \subseteq \ffa \overbar{R}$. Hence $s \in \operatorname{rad}(\ffa \overbar{R})$. \par 
    ``$\supseteq$''. Let $t \in \operatorname{rad}(\ffa \overbar{R})$. Then $t^{n} \in \ffa \overbar{R}$ for some $n \geq 1$. So $t^{n} = \sum_{i=1}^{m} \alpha_is_i$ for some $m \geq 1$, $\alpha_1,\cdots,\alpha_m \in \ffa$ and $s_1,\cdots,s_m \in \overbar{R}$. Let $T := R[s_1,\cdots,s_m] \subseteq \overbar{R} \subseteq S$. Then $t^{n} \in \ffa T$. So $t^{n}T \subseteq \ffa T$. Since $s_1,\cdots,s_m$ is integral over $R$, $T$ is a finitely generated $R$-module by Theorem 5.19. By determinant trick as in the proof of Proposition 5.13, we have $t^{n}$ is integral over $\ffa$. So $(t^{n})^{l} + b_{l-1}(t^{n})^{l-1} + \cdots + b_0 = 0$ for some $l \geq 1$ and $b_0,\cdots,b_{l-1} \in \ffa$. Hence $t$ is integral over $\ffa$.
\end{proof}

\begin{proposition}
    Let $R$ be integrally closed and $\overbar{\ffa}$ be the integral closure of $\ffa \leq R$ in $S$. Let $s \in \overbar{\ffa}$ and $g(X) = X^{m} + c_{m-1}X^{m-1} + \cdots + c_0 \in Q(R)[X]$ be the minimal polynomial of $s$ over $Q(R)$. Then $c_0,\cdots,c_{m-1} \in \operatorname{rad}(\ffa)$.
\end{proposition}

\begin{proof}
    Let $s_1:=s,s_2,\cdots,s_m$ be the roots of $g(X)$ in some algebraic closure of $Q(R)$. Since $s$ is integral over $\ffa$, $s$ satisfies a monic $f \in \ffa[X] \subseteq Q(R)[X] = Q(R)[X]$. Also, since $g$ is the minimal polynomial of $s$ over $Q(R)$, there exists $h \in Q(R)[X]$ such that $f = hg$. Since $f(s_i) = h(s_i)g(s_i) = 0$, $s_i \in \overbar{\ffa}$ for $i = 1,\cdots,m$. Since $g(X) = (X-s_1) \cdots (X-s_m)$ and $\overbar{\ffa} \leq \overbar{R}$ by Lemma 5.37, $c_0,\cdots,c_{m-1} \in \overbar{\ffa} = \operatorname{rad}(\ffa \overbar{R}) = \operatorname{rad}(\ffa R) = \operatorname{rad}(\ffa)$. 
\end{proof}

\begin{theorem}[Going down theorem]
    Let $R \subseteq S$ be a subring with $R$ integrally closed and $S$ an integral domain. Let $\ffp_1 \supseteq \cdots \supseteq \ffp_n$ be a chain in $\operatorname{Spec}(R)$ and $\ffq_1 \supseteq \cdots \supseteq \ffq_m$ ($m < n$) be a chain in $\operatorname{Spec}(S)$ such that $\ffq_i \cap R = \ffp_i$ for $i = 1,\cdots,m$. Then there exists a chain $\ffq_m \supseteq \cdots \supseteq \ffq_n$ in $\operatorname{Spec}(S)$ such that $\ffq_i \cap R = \ffp_i$ for $i = 1,\cdots,n$. 
\end{theorem}

\begin{proof}
    As in the going up theorem, assume without loss of generality that $m = 1$ and $n = 2$. Let $\ffp \supseteq \ffp'$ be a chain in $\operatorname{Spec}(R)$ and $\ffq \in \operatorname{Spec}(S)$ such that $\ffq \cap R = \ffp$. Since $S$ is an integral domain, $S \setminus \ffq \subseteq \operatorname{NZD}(S)$. So $S_\ffq \supseteq S \supseteq R$. Claim. $(\ffp'S_\ffq) \cap R = \ffp'$, then (if and only if) there exists $Q' \in \operatorname{Spec}(S_\ffq)$ such that $Q' \cap R = \ffp'$ by Theorem 3.24, so (if and only if) there exists $\ffq \supseteq \ffq' \in \operatorname{Spec}(S)$ such that $\ffq' \cap R = \ffp'$\footnote[2]{For ``$\Rightarrow$'', take $\ffq' = Q' \cap S$, then $\ffq' \cap R = (Q' \cap S) \cap R = Q' \cap R = \ffp'$. For ``$\Leftarrow$'', take $Q' = \ffq' S_\ffq$, then $Q' \cap R = (\ffq'S_\ffq \cap S) \cap R = \ffq' \cap R = \ffp'$ by prime correspondence for localization.} by prime correspondence for localization. \par
    ``$\supseteq$''. By 1.63(a). \par
    ``$\subseteq$''. Let $0 \neq x \in (\ffp'S_\ffq) \cap R$. Then $x \in \ffp'S_\ffq = \ffp' (S \setminus \ffq)^{-1}S = (S \setminus \ffq)^{-1} (\ffp'S)$. So $x = \frac{s}{v}$ for some $s \in \ffp'S$ and $v \in S \setminus \ffq$. Since $R \subseteq S$ is integral, $\overbar{R} = S$, where $\overbar{R}$ is the integral closure of $R$ in $S$. So $s \in \ffp'S \subseteq \operatorname{rad}(\ffp'S) = \operatorname{rad}(\ffp'\overbar{R}) = \overbar{\ffp'}$ by Lemma 5.37. Hence $s \in S$ is integral over $\ffp'$. Let $g(X) = X^{r} + u_{r-1}X^{r-1} + \cdots + u_0 \in Q(R)[X]$ be the minimal polynomial of $s$ over $Q(R)$. Then by Proposition 5.38, $u_0,\cdots,u_{r-1} \in \operatorname{rad}(\ffp') = \ffp'$. Since $0 \neq x = \frac{s}{v}$ and $R$ is an integral domain, $v = sx^{-1}$ in $Q(R)$. Note $v$ satisfies $X^{r} + \smallunderbrace{(u_{r-1}x^{-1})}_{t_{r-1}} X^{r-1} + \smallunderbrace{(u_{r-2}x^{-2})}_{t_{r-2}}X^{r-2} + \cdots + \smallunderbrace{(u_0x^{-r})}_{t_0} \in Q(R)[X]$, which is a minimal polynomial for $v$ over $Q(R)$ since if $v$ satisfies a smaller degree polynomial over $Q(R)$, then so does $S$. Also, since $v \in S$ is integral over $R$, by Proposition 5.38, we have $t_0,\cdots,t_{r-1} \in \operatorname{rad}(\langle 1 \rangle R) = R$. Suppose $x \not\in \ffp'$. Since $u_i = t_{i}x^{r-i} \in \ffp' \in \operatorname{Spec}(R)$, $t_i \in \ffp'$ for $i = 0,\cdots,r-1$. So $v^{r} = -(t_{r-1}v^{r-1} + t_{r-2}v^{r-2} + \cdots + t_0) \in \ffp'S \subseteq \ffp S = (\ffq \cap R)S \subseteq \ffq S = \ffq \in \operatorname{Spec}(S)$. Hence $v \in \ffq$, a contradiction. Thus, $x \in \ffp'$.
\end{proof}

\begin{theorem}[Noether normalization]
    Let $k$ be a field and $k \subseteq R: = k[x_1,\cdots,x_n]$ be a subring. 
    \begin{enumerate}
        \item There exist an intermediate subring $k \subseteq S \subseteq R$ and $y_1,\cdots,y_d \in R$ such that $S = k[y_1,\cdots,y_d] \cong k[Y_1,\cdots,Y_d]$, a polynomial ring, with $d \leq n$ and $R$ integral over $S$. So $R = S[x_1,\cdots,x_n]$ is a finitely generated $S$-module. Moreover, $y_i$ is a polynomial in $x_j$'s with coefficients in $k$ for $i = 1,\cdots,d$. 
        \item If $\abs k = \infty$, then we can take some $d$ and $y_i = \sum_{j=1}^{n} a_{ij}x_j$ for some $a_{i1},\cdots,a_{in} \in k$ for $i = 1,\cdots,d$. \par
    \end{enumerate}
    (In fact, $d$ is uniquely determined and is the Krull dimension of $R$.)
\end{theorem}

\begin{proof} 
    \textbf{Definition.} Let $z_1,\cdots,z_m \in R$ and $k[Z_1,\cdots,Z_m]$ be a polynomial ring. Consider the ring homomorphism $k[Z_1,\cdots,Z_m] \overset n \twoheadrightarrow k[z_1,\cdots,z_m]$ given by $F \mapsto F(z_1,\cdots,z_m)$. $z_1,\cdots,z_m$ is \emph{algebraically independent} over $k$ if $n$ is 1-1, i.e., $n$ is an isomorphism. (No polynomial relations between the $z_i$'s.) \par 
    Structure of proof: induct on $n$. Base case $n = 0$: $R = k$ ($S = k$). Base case $n = 1$: $R = k[x] \overset n \twoheadleftarrow k[X]$. If $n$ is 1-1, then $S = R$. If $n$ is not 1-1, then $x$ satisfies some monic $F \in k[X]$, so $x$ is integral over $k$, hence $S = k \subseteq R = k[x]$ with $d = 0$ and $S \subseteq R$ an integral extension. \par 
    Inductive step: Assume $n > 1$ and the result is true for rings of form $k[z_1,\cdots,z_{n-1}]$. If $x_1,\cdots,x_n$ are algebraically independent over $k$, then use $S = R = k[x_1,\cdots,x_n] \xleftarrow[\cong]{n}  k[X_1,\cdots,X_n]$. Assume now $x_1,\cdots,x_n$ are not algebraically independent over $k$. Re-order $x_1,\cdots,x_n$ such that $x_1,\cdots,x_r$ ($r < n$) are algebraically independent and $x_1,\cdots,x_r,x_s$ are algebraically dependent for $s = r+1,\cdots,n$. Then by inductive hypothesis and Corollary 5.20, it suffices to show $R$ is integral over $k[w_1,\cdots,w_{n-1}]$ for some $w_1,\cdots,w_{n-1} \in R$. Consider $k[X_1,\cdots,X_n] \overset n \twoheadrightarrow k[x_1,\cdots,x_n]$. Then there exists $0 \neq F \in k[X_1,\cdots,X_n]$ such that $n(F) = 0$. Let $e = \deg(F)$ and  write $F = F_0 + F_1 + \cdots + F_e$, where $F_i$ is homogeneous of degree $i$ for $i= 0,\cdots,e$. 
    \begin{enumerate}
        \item[(b)] Assume $\abs k = \infty$. Since $F_e \neq 0$, $F_e(\lambda_1,\cdots,\lambda_{n-1},1) \neq 0$ for some $\lambda_1,\cdots,\lambda_{n-1} \in k$. Look at $k[w_1,\cdots,w_{n-1},x_n] \in R$. For $\underline b = (b_1,\cdots,b_n) \in \bbZ_{\geq 0}^{n}$, $(w_1+\lambda_1 x_n)^{b_1} \cdots (w_{n-1} + \lambda_{n-1}x_n)^{b_{n-1}} \cdot x_n^{b_n} = \lambda_1^{b_1} \cdots \lambda_{n-1}^{b_{n-1}} x_n^{\abs {\underline b}} + \text{lower degree terms in $x_n$}$, where $\abs{\underline b} = b_1 + \cdots + b_n$. Note for $i = 0,\cdots,e$,
            \begin{align*}
                F_i(w_1+\lambda_1x_n,\cdots,w_{n-1}+\lambda_{n-1}x_n,x_n) &= \sum_{\abs{\underline b} = i} a_{\underline b} (\lambda_1^{b_1} \cdots \lambda_{n-1}^{b_{n-1}})x_n^{i} + \text{lower degree terms in $x_n$} \\
                &= F_i(\lambda_1,\cdots,\lambda_{n-1},1)x_n^{i} + \text{lower degree terms in $x_n$}. 
            \end{align*}
            Let $G(w_1,\cdots,w_{n-1},x_n) = F(w_1+\lambda_1x_n,\cdots,w_{n-1}+\lambda_{n-1}x_n,x_n) = F_e(\lambda_1,\cdots,\lambda_{n-1},1)x_n^{e} + \text{lower degree terms in $x_n$}$. Let $w_i := x_i-\lambda_ix_n$ for $i = 1,\cdots,n-1$. Then $G(w_1,\cdots,w_{n-1},x_n) = F(x_1-\lambda_1x_n+\lambda_1x_n,\cdots,x_{n-1}-\lambda_{n-1}x_n + \lambda_{n-1}x_n,x_n) = F(x_1,\cdots,x_{n-1},x_n) = n(F) = 0$. Since $F_e(\lambda_1,\cdots,\lambda_{n-1},1) \neq 0$, $x_n$ satisfies a monic $\frac{G(w_1,\cdots,w_{n-1},X_n)}{F_e(\lambda_1,\cdots,\lambda_{n-1},1)} \in k[w_1,\cdots,w_{n-1}][X_n]$. So $x_n$ is integral over $k[w_1,\cdots,w_{n-1}]$. Hence $R = k[x_1,\cdots,x_{n-1},x_n] = k[x_1-\lambda x_n,\cdots,x_{n-1}-\lambda_{n-1}x_n,x_n] = k[w_1,\cdots,w_{n-1}][x_n]$ is integral over $k[w_1,\cdots,w_{n-1}]$ by Theorem 5.19. \par 
        \item[(a)]   
            Look at $k[w_1,\cdots,w_{n-1},x_n] \in R$. Let $e_n = 1$. For $\underline b = (b_1,\cdots,b_n) \in \bbZ_{\geq 0}^{n}$ and $e_1,\cdots,e_{n-1} \gg 1$, $(w_1+x_n^{e_1})^{b_1} \cdots (w_{n-1} + x_n^{e_{n-1}})^{b_{n-1}} \cdot x_n^{b_n} = x_n^{\sum_{i=1}^{n}e_ib_i} + \text{lower degree terms in $x_n$}$. Write $F = \sum_{j=1}^{m} a_j \underline x^{\underline b_j}$ for some $m \geq 1$ and distinct $\underline x^{\underline b_j} := x_1^{b_{j_1}} \cdots x_n^{b_{j_n}}$ and $a_j \neq 0$ for $j = 1,\cdots,m$. Let $A_i = \max\{b_{1_i},\cdots,b_{m_i}\} - \min\{b_{1_i},\cdots,b_{m_i}\}$ for $i = 1,\cdots,n$. Choose $e_{i-1} > A_ie_i + \cdots + A_ne_n$ for $i = 2,\cdots,n$. Re-order $a_1 \underline x^{\underline b_1},\cdots,a_m \underline x^{\underline b_m}$ such that $\underline b_1 \succcurlyeq \cdots \succcurlyeq \underline b_m$ in descending lexicographical order. Then $\sum_{i=1}^{n}e_ib_{1_i} > \sum_{i=1}^{n} e_ib_{2_i} > \cdots > \sum_{i=1}^{n} e_ib_{m_i}$. Let $G(w_1,\cdots,w_{n-1},x_n) = F(w_1+x_n^{e_1},\cdots,w_{n-1}+x_n^{e_{n-1}},x_n) = a_1x_n^{\sum_{i=1}^{n}e_ib_{1_i}}+\,$lower degree terms in $x_n$. Let $w_i := x_i-x_n^{e_i}$ for $i = 1,\cdots,n-1$. Then $G(w_1,\cdots,w_{n-1},x_n) = F(x_1,\cdots,x_{n-1},x_n) = n(F) = 0$. Since $a_1 \neq 0$, $x_n$ satisfies a monic $\frac{G(w_1,\cdots,w_{n-1},X_n)}{a_1} \in k[w_1,\cdots,w_{n-1}][X_n]$. So $x_n$ is integral over $k[w_1,\cdots,w_{n-1}]$. Hence $R = k[x_1,\cdots,x_{n-1},x_n] = k[x_1-x_n^{e_1},\cdots,x_{n-1}-x_{n}^{e_{n-1}},x_n] = k[w_1,\cdots,w_{n-1}][x_n]$ is integral over $k[w_1,\cdots,w_{n-1}]$ by Theorem 5.19. \qedhere
    \end{enumerate}
\end{proof}

\begin{theorem}[Hilbert Nullstellensatz, version 1]
    Let $k \subseteq K := k[x_1,\cdots,x_n]$ be a subfield.
    \begin{enumerate}
        \item $K$ is algebraic over $k$ and $[K:k] < \infty$.
        \item If $k$ is algebraically closed, then $K = k$.
    \end{enumerate}
\end{theorem}

\begin{proof}
    \begin{enumerate}
        \item Let $k \subseteq S \subseteq K$ be a Noether normalization of $k \subseteq K$. Then there exists $y_1,\cdots,y_d \in K$ such that $S = k[y_1,\cdots,y_d] = k[Y_1,\cdots,Y_d] \subseteq K$ and $K$ is integral over $k[Y_1,\cdots,Y_d]$. Since $K$ is a field, by Proposition 5.24, $k[Y_1,\cdots,Y_d]$ is a field. So $d = 0$. Then $S = k$. So $K = k[x_1,\cdots,x_n]$ is integral over $k$. Hence $K$ is a finite-dimensional $k$-vector space by Theorem 5.19.
        \item Since $k$ is algebraically closed, there is no proper algebraic extensions. So $K = k$. \qedhere
    \end{enumerate}
\end{proof}

\begin{theorem}[Hilbert Nullstellensatz, version 2]
    Let $k$ be an algebraically closed field, $R = k[X_1,\cdots,X_n]$ and $\ffm \in \operatorname{m-Spec}(R)$. Then there exists $\underline a \in k^{n}$ such that $\ffm = \langle X_1-a_1,\cdots,X_n-a_n \rangle$.
\end{theorem}

\begin{proof}
    Set $K = R/\ffm = k[x_1,\cdots,x_n] \hookleftarrow k$, where $x_i = \overbar{X_i} \in R/\ffm$ for $i = 1,\cdots,n$. Since $k$ is algebraically closed and $k \hookrightarrow K$ is a subfield, by Hilbert Nullstellensatz, version 1(b), $k \hookrightarrow k[x_1,\cdots,x_n] = R/\ffm$ is onto. Since $x_i \in R/\ffm$, there exists $a_i \in k$ such that $a_i \mapsto x_i$ for $i = 1,\cdots,n$. So $x_i - a_i = 0$ in $R/\ffm$, i.e., $X_i - a_i \in \ffm$ for $i = 1,\cdots,n$. Then $\ffm \supseteq \langle X_1-a_1,\cdots,X_n-a_n \rangle$. Since $\ffm,\langle X_1-a_1,\cdots,X_n-a_n \rangle \in \operatorname{m-Spec}(R)$, $\ffm = \langle X_1-a_1,\cdots,X_n-a_n \rangle$.
\end{proof}

\begin{theorem}[Hilbert Nullstellensatz, version 3]
    Let $k$ be an algebraically closed field, $\ffa \lneq R = k[X_1,\cdots,X_n]$. Then $\operatorname{Z}(\ffa) := \{\underline a \in k^{n} \mid F(\underline a) = 0, \fa F \in \ffa\} \neq \emptyset$.
\end{theorem}

\begin{proof}
    Since $\ffa \neq R$, by Hilbert Nullstellensatz, version 2, $\ffa \subseteq \ffm := \langle X_1-a_1,\cdots,X_n-a_n \rangle$ for some $\underline a \in k^{n}$. Let $F \in \ffa \subseteq \ffm$. Then $F = \sum_{i=1}^{n} g_i(X_i-a_i)$ for some $g_1,\cdots,g_n \in R$. So $F(\underline a) = \sum_{i=1}^{n} g_i(\underline a)(a_i - a_i) = 0$. Thus, $\underline a \in \operatorname{Z}(\ffa)$.
\end{proof}

\begin{theorem}[Hilbert Nullstellensatz, version 4]
    Let $k$ be an algebraically closed field, $\ffa \lneq R = k[X_1,\cdots,X_n]$ and $Z = \operatorname{Z}(\ffa)$. Let $I = \operatorname{I}(Z) = \{F \in R \mid F(\underline a) = 0, \fa \underline a \in Z\} \leq R$. Then $I = \operatorname{rad}(\ffa)$.
\end{theorem}

\begin{proof}
    ``$\supseteq$''.  Since $I = \operatorname{I}(Z) = \operatorname{I}(\operatorname{Z}(\ffa)) = \{F \in R \mid F(\underline a) = 0, \fa \underline a \in \operatorname{Z}(\ffa)\} \supseteq \ffa$, $\operatorname{rad}(\ffa) \subseteq \operatorname{rad}(I) = I$. \par 
    ``$\subseteq$''. Let $F \in R \setminus \operatorname{rad}(\ffa)$. Then $F \not \in \operatorname{rad}(\ffa) = \bigcap_{\ffp \in \operatorname{V}(\ffa)} \ffp$ by Fact 1.58. So there exists $\ffp \in \operatorname{V}(\ffa)$ such that $F \not\in \ffp$. Set $\overbar{R} = R/\ffp = k[x_1,\cdots,x_n]$, an integral domain, where $x_i = \overbar{X_i} \in R/\ffp$ for $i = 1,\cdots,n$. Since $F \not\in \ffp$, $f := \overbar{F} \neq 0$ in $\overbar{R}$. Then $0 \neq \overbar{R} \subseteq \overbar{R}_f = \overbar{R}[1/f] = k[x_1,\cdots,x_n,1/f]$. So there exists $\ffm \in \operatorname{m-Spec}(\overbar{R}_f)$. Consider $k \hookrightarrow \overbar{R}_f/\ffm = k[\overbar{x_1},\cdots,\overbar{x_n},\overbar{1/f}]$, where $\overbar{1/f} \neq 0$ in $\overbar{R}_f/\ffm$ since $1/f \in \overbar{R}_f^{\times}$. Since $k$ is algebraically closed and $k \hookrightarrow \overbar{R}_f/\ffm$ is a subfield, by Hilbert Nullstellensatz, version 1(b), $k \hookrightarrow \overbar{R}_f/\ffm$ is onto. Since $\overbar{x_i} \in \overbar{R}_f/\ffm$, there exists $a_i \in k$ such that $a_i \mapsto \overbar{x_i}$ for $i = 1,\cdots,n$. Since $\ffa \subseteq \ffp$, $\ffa \cdot \overbar{R} = 0$. So $\ffa \cdot \overbar{R}_f/\ffm = 0$. Then $G(\underline a) = \overbar{g}(\overbar{x_1},\cdots,\overbar{x_n}) = \overbar{g} = 0$ in $\overbar{R}_f/\ffm$ for all $G \in \ffa$. Hence $\underline a \in \operatorname{Z}(\ffa) = Z$. Also, since $F(\underline a) = \overbar{f}(\overbar{x_1},\cdots,\overbar{x_n}) = \overbar{f} \neq 0$ in $\overbar{R}_f/\ffm$, we have $F \not\in \operatorname{I}(Z) = I$.
\end{proof}
